
/*!
  pow-core - v0.0.3
  built: 2014-08-02
 */

var pow2;!function(a){function b(a){return e[a]}function c(a,b){if(!a)throw new Error("Cannot register world with null name");if(e.hasOwnProperty(a))throw new Error("Cannot register world multiple times with the same name");return e[a]=b,e[a]}function d(a){if(!a)throw new Error("Cannot unregister a world with null name");if(!e.hasOwnProperty(a))throw new Error("Cannot unregister non existent world");var b=e[a];return delete e[a],b}var e={};a.getWorld=b,a.registerWorld=c,a.unregisterWorld=d}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function a(){}return a.prototype.on=function(a,b,c){if(!d(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var e=this._events[a]||(this._events[a]=[]);return e.push({callback:b,context:c,ctx:c||this}),this},a.prototype.once=function(a,b,c){if(!d(this,"once",a,[b,c])||!b)return this;var e=this,f=_.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,c)},a.prototype.off=function(a,b,c){var e,f,g,h,i,j,k,l;if(!this._events||!d(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events=void 0,this;for(h=a?[a]:_.keys(this._events),i=0,j=h.length;j>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||c)for(k=0,l=g.length;l>k;k++)f=g[k],(b&&b!==f.callback&&b!==f.callback._callback||c&&c!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},a.prototype.trigger=function(a){for(var b=[],c=0;c<arguments.length-1;c++)b[c]=arguments[c+1];if(!this._events)return this;var b=Array.prototype.slice.call(arguments,1);if(!d(this,"trigger",a,b))return this;var f=this._events[a],g=this._events.all;return f&&e(f,b),g&&e(g,arguments),this},a}();a.Events=b;var c=/\s+/,d=function(a,b,d,e){if(!d)return!0;if("object"==typeof d){for(var f in d)a[b].apply(a,[f,d[f]].concat(e));return!1}if(c.test(d)){for(var g=d.split(c),h=0,i=g.length;i>h;h++)a[b].apply(a,[g[h]].concat(e));return!1}return!0},e=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}}}(pow2||(pow2={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},pow2;!function(a){var b=function(a){function b(b,c){"undefined"==typeof c&&(c=null),a.call(this),this.loader=null,this._ready=!1,this.url=b,this.data=c}return __extends(b,a),b.prototype.load=function(){console.log("Loading: "+this.url)},b.prototype.setLoader=function(a){this.loader=a},b.prototype.isReady=function(){return null!==this.data&&this._ready===!0},b.prototype.ready=function(){this._ready=!0,this.trigger("ready",this)},b.prototype.failed=function(a){this._ready=!1,console.log("ERROR loading resource: "+this.url+"\n   -> "+a),this.trigger("failed",this)},b}(a.Events);a.Resource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function a(b,c){b instanceof a?this.set(b.x,b.y):"string"==typeof b&&"string"==typeof c?this.set(parseFloat(b),parseFloat(c)):"number"==typeof b&&"number"==typeof c?this.set(b,c):this.zero()}return a.prototype.toString=function(){return""+this.x+","+this.y},a.prototype.set=function(b,c){return b instanceof a?(this.x=b.x,this.y=b.y):(this.x="undefined"!=typeof b?b:0,this.y="undefined"!=typeof c?c:0),this},a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this},a.prototype.truncate=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},a.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},a.prototype.add=function(b,c){return b instanceof a?(this.x+=b.x,this.y+=b.y):b&&"undefined"==typeof c?(this.x+=b,this.y+=b):(this.x+=b,this.y+=c),this},a.prototype.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.multiply=function(b,c){return b instanceof a?(this.x*=b.x,this.y*=b.y):b&&"undefined"==typeof c?(this.x*=b,this.y*=b):(this.x*=b,this.y*=c),this},a.prototype.divide=function(b,c){if(b instanceof a){if(0===b.x||0===b.y)throw new Error("Divide by zero");this.x/=b.x,this.y/=b.y}else if(b&&"undefined"==typeof c){if(0===b)throw new Error("Divide by zero");this.x/=b,this.y/=b}else{if(0===b||0===c)throw new Error("Divide by zero");this.x/=b,this.y/=c}return this},a.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this},a.prototype.equal=function(a){return this.x===a.x&&this.y===a.y},a.prototype.isZero=function(){return 0===this.x&&0===this.y},a.prototype.zero=function(){return this.x=this.y=0,this},a.prototype.interpolate=function(a,b,c){return c=Math.min(Math.max(c,0),1),this.x=a.x*(1-c)+b.x*c,this.y=a.y*(1-c)+b.y*c,this},a.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y},a.prototype.normalize=function(){var a=this.magnitude();return a>0&&(this.x/=a,this.y/=a),this},a}();a.Point=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(c,d,e,f){return c instanceof b?(this.point=new a.Point(c.point),this.extent=new a.Point(c.extent)):e&&f?(this.point=new a.Point(c,d),this.extent=new a.Point(e,f)):c instanceof a.Point&&d instanceof a.Point?(this.point=new a.Point(c),this.extent=new a.Point(d)):(this.point=new a.Point(0,0),this.extent=new a.Point(1,1)),this}return b.prototype.toString=function(){return"p("+this.point.toString()+") extent("+this.extent.toString()+")"},b.prototype.set=function(c,d,e,f){if(c instanceof b)this.point.set(c.point),this.extent.set(c.extent);else if(e&&f)this.point.set(c,d),this.extent.set(e,f);else{if(!(c instanceof a.Point&&d instanceof a.Point))throw new Error("Unsupported arguments to Rect.set");this.point.set(c),this.extent.set(d)}return this},b.prototype.clone=function(){return new b(this.point.clone(),this.extent.clone())},b.prototype.clamp=function(a){return this.point.x<a.point.x&&(this.point.x+=a.point.x-this.point.x),this.point.y<a.point.y&&(this.point.y+=a.point.y-this.point.y),this.point.x+this.extent.x>a.point.x+a.extent.x&&(this.point.x-=this.point.x+this.extent.x-(a.point.x+a.extent.x)),this.point.y+this.extent.y>a.point.y+a.extent.y&&(this.point.y-=this.point.y+this.extent.y-(a.point.y+a.extent.y)),this},b.prototype.clip=function(a){var b=this.point.x+this.extent.x,c=this.point.y+this.extent.y;return this.point.x=Math.max(a.point.x,this.point.x),this.extent.x=Math.min(a.point.x+a.extent.x,b)-this.point.x,this.point.y=Math.max(a.point.y,this.point.y),this.extent.x=Math.min(a.point.y+a.extent.y,c)-this.point.y,this},b.prototype.isValid=function(){return this.extent.x>0&&this.extent.y>0},b.prototype.intersect=function(a){return!(a.point.x>this.point.x+this.extent.x||a.point.x+a.extent.x<this.point.x||a.point.y>this.point.y+this.extent.y||a.point.y+a.extent.y<this.point.y)},b.prototype.pointInRect=function(b,c){var d=0;return b instanceof a.Point?(d=b.x,c=b.y):d=b,d>=this.point.x+this.extent.x||c>=this.point.y+this.extent.y?!1:!(d<this.point.x||c<this.point.y)},b.prototype.getCenter=function(){var b=parseFloat((this.point.x+.5*this.extent.x).toFixed(2)),c=parseFloat((this.point.y+.5*this.extent.y).toFixed(2));return new a.Point(b,c)},b.prototype.setCenter=function(b,c){var d;return b instanceof a.Point?(d=b.x,c=b.y):d=b,this.point.x=parseFloat((d-.5*this.extent.x).toFixed(2)),this.point.y=parseFloat((c-.5*this.extent.y).toFixed(2)),this},b.prototype.scale=function(a){return this.point.multiply(a),this.extent.multiply(a),this},b.prototype.round=function(){return this.point.round(),this.extent.set(Math.ceil(this.extent.x),Math.ceil(this.extent.y)),this},b.prototype.getLeft=function(){return this.point.x},b.prototype.getTop=function(){return this.point.y},b.prototype.getRight=function(){return this.point.x+this.extent.x},b.prototype.getBottom=function(){return this.point.y+this.extent.y},b.prototype.getHalfSize=function(){return new a.Point(this.extent.x/2,this.extent.y/2)},b.prototype.addPoint=function(a){a.x<this.point.x&&(this.extent.x=this.extent.x-(a.x-this.point.x),this.point.x=a.x),a.y<this.point.y&&(this.extent.y=this.extent.y-(a.x-this.point.y),this.point.y=a.y),a.x>this.point.x+this.extent.x&&(this.extent.x=a.x-this.point.x),a.y>this.point.y+this.extent.y&&(this.extent.y=a.y-this.point.y)},b.prototype.inflate=function(a,b){return"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=1),this.point.x-=a,this.extent.x+=2*a,this.point.y-=b,this.extent.y+=2*b,this},b}();a.Rect=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,c=_.keys(b.types).length,d=[],e=function(b){c--,d.push(b),0>=c&&a.failed("No valid sources at the following URLs\n   "+d.join("\n   "))},f=document.createElement("audio");_.each(b.types,function(b,c){if(f.canPlayType(b+";")){var d=document.createElement("source");d.type=b,d.src=a.url+"."+c,d.addEventListener("error",function(a){return e(d.src),a.preventDefault(),a.stopImmediatePropagation(),!1}),f.appendChild(d)}}),f.addEventListener("canplaythrough",function(){a.data=f,a.ready()}),f.load()},b.types={mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav"},b}(a.Resource);a.AudioResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=document.createElement("img");b.onload=function(){a.data=b,a.ready()},b.onerror=function(b){a.failed(b)},b.src=this.url},b}(a.Resource);a.ImageResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=$.getJSON(this.url);b.done(function(b){a.data=b,a.ready()}),b.fail(function(b,c,d){a.failed(d)})},b}(a.Resource);a.JSONResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=$.getScript(this.url);b.done(function(b){a.data=b,a.ready()}),b.fail(function(b,c,d){a.failed(d)})},b}(a.Resource);a.ScriptResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=$.get(this.url);b.done(function(b){a.data=$(b),a.prepare(a.data)}),b.fail(function(b,c,d){a.failed(d)})},b.prototype.prepare=function(){this.ready()},b.prototype.getElTag=function(a){if(a){var b=a.prop("tagName");if(b)return b.toLowerCase()}return null},b.prototype.getRootNode=function(a){return this.data?$(_.find(this.data,function(b){return b.tagName&&b.tagName.toLowerCase()===a})):null},b.prototype.getChildren=function(a,b){var c=a.find(b);return _.compact(_.map(c,function(b){var c=$(b);return c.parent()[0]!==a[0]?null:c}))},b.prototype.getChild=function(a,b){return this.getChildren(a,b)[0]},b.prototype.getElAttribute=function(a,b){if(a){var c=a.attr(b);if(c)return c}return null},b}(a.Resource);a.XMLResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=null,c=function(){function c(a){this.autoStart=!1,this.tickRateMS=32,this.mspf=0,this.world=null,this.lastTime=0,this.time=0,this.running=!1,this.objects=[],_.extend(this,a||{}),this.polyFillAnimationFrames(),this.autoStart&&this.start()}return c.get=function(){return b||(b=new a.Time({autoStart:!0})),b},c.prototype.start=function(){var a=this;if(!this.running){this.running=!0;var b=function(c){a.time=Math.floor(c);var d=(new Date).getMilliseconds(),e=Math.floor(c-a.lastTime);e>=a.tickRateMS&&(a.lastTime=c,a.tickObjects(e)),a.processFrame(e),a.mspf=(new Date).getMilliseconds()-d,window.requestAnimationFrame(b)};b(0)}},c.prototype.stop=function(){this.running=!1},c.prototype.removeObject=function(a){this.objects=_.reject(this.objects,function(b){return b._uid===a._uid})},c.prototype.addObject=function(a){if(!a._uid)throw new Error("Invalid object contains no _uid ->"+a);_.where(this.objects,{_uid:a._uid}).length>0||this.objects.push(a)},c.prototype.tickObjects=function(a){for(var b=this.objects,c=b.length-1;c>=0;--c)b[c].tick&&b[c].tick(a)},c.prototype.processFrame=function(a){for(var b=this.objects,c=b.length-1;c>=0;--c)b[c].processFrame&&b[c].processFrame(a)},c.prototype.polyFillAnimationFrames=function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length;c++){if(window.requestAnimationFrame)return;window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=function(){b(c+d)},f=window.setTimeout(e,d);return a=c+d,f})},c}();a.Time=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function a(){this.transitions=[]}return a.prototype.enter=function(){},a.prototype.exit=function(){},a.prototype.update=function(a){for(var b=this.transitions.length,c=0;b>c;c++){var d=this.transitions[c];if(d.evaluate(a)&&a.setCurrentState(d.targetState))return}},a}();a.State=b;var c=function(){function a(){}return a.prototype.evaluate=function(){return!0},a}();a.StateTransition=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.defaultState=null,this.states=[],this._currentState=null,this._previousState=null,this._newState=!1}return __extends(b,a),b.prototype.onAddToWorld=function(){},b.prototype.onRemoveFromWorld=function(){},b.prototype.update=function(){this._newState=!1,null===this._currentState&&this.setCurrentState(this.defaultState),null!==this._currentState&&this._currentState.update(this),this._newState===!1&&null!==this._currentState&&(this._previousState=this._currentState)},b.prototype.addState=function(a){this.states.push(a)},b.prototype.addStates=function(a){this.states=_.unique(this.states.concat(a))},b.prototype.getCurrentState=function(){return this._currentState},b.prototype.getCurrentName=function(){return null!==this._currentState?this._currentState.name:null},b.prototype.setCurrentState=function(a){var b="string"==typeof a?this.getState(a):a,c=this._currentState;return b?this._currentState&&b.name===this._currentState.name?(console.warn("Attempting to set current state to already active state"),!0):(this._newState=!0,this._previousState=this._currentState,this._currentState=b,c&&(this.trigger("exit",c,b),c.exit(this)),b.enter(this),this.trigger("enter",b,c),!0):(console.error("STATE NOT FOUND: "+a),!1)},b.prototype.getPreviousState=function(){return this._previousState},b.prototype.getState=function(a){var b=_.find(this.states,function(b){return b.name===a});return b},b}(a.Events);a.StateMachine=b;var c=function(a){function b(){a.apply(this,arguments),this.paused=!1}return __extends(b,a),b.prototype.onAddToWorld=function(a){a.time.addObject(this)},b.prototype.onRemoveFromWorld=function(a){a.time.removeObject(this)},b.prototype.tick=function(a){this.update(a)},b}(b);a.TickedStateMachine=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(b){var c=this;this.loader=null,b=_.defaults(b||{},{loader:new a.ResourceLoader,time:new a.Time({autoStart:!0}),state:null}),_.extend(this,b),_.each(b,function(a){c.mark(a)})}return b.prototype.setService=function(a,b){return this.mark(b),this[a]=b,b},b.prototype.mark=function(a){a&&(a.world=this,a.onAddToWorld&&a.onAddToWorld(this))},b.prototype.erase=function(a){a&&(a.onRemoveFromWorld&&a.onRemoveFromWorld(this),delete a.world)},b}();a.World=b}(pow2||(pow2={}));var pow2;!function(a){var b=null,c=function(){function c(){this._cache={},this._types={png:a.ImageResource,js:a.ScriptResource,json:a.JSONResource,xml:a.XMLResource,"":a.AudioResource},this._doneQueue=[],this.world=null,this._uid=_.uniqueId("res")}return c.get=function(){return b||(b=new a.ResourceLoader),b},c.prototype.onAddToWorld=function(a){a.time.addObject(this)},c.prototype.onRemoveFromWorld=function(a){a.time.removeObject(this)},c.prototype.tick=function(){},c.prototype.processFrame=function(){var a=this._doneQueue;this._doneQueue=[],_.each(a,function(a){a.cb(a.result)})},c.prototype.ensureType=function(a,b){this._types[a]=b},c.prototype.getResourceExtension=function(a){var b=a.lastIndexOf(".");return-1===b?"":a.substr(b+1)},c.prototype.create=function(a,b){var c=new a(null,b);return c.setLoader(this),c},c.prototype.loadAsType=function(a,b,c){var d=this,e=function(a){d.world&&c?d._doneQueue.push({cb:c,result:a}):c&&_.defer(function(){c(a)})};if(!b)return e(null),void console.error("Unknown resource type: "+a);var f=this._cache[a];if(f){if(f.isReady())return e(f)}else f=this._cache[a]=new b(a,this),f.setLoader(this);return f.once("ready",function(a){console.log("Loaded asset: "+a.url),e(a)}),f.once("failed",function(a){console.log("Failed to load asset: "+a.url),e(null)}),f.load(),f},c.prototype.load=function(a,b){function c(){if(b&&0===e){var a=d.length>1?d:d[0];b(a)}}var d=[],e=0;_.isArray(a)||(a=[a]);for(var f=0;f<a.length;f++){var g=a[f],h=this.getResourceExtension(g),i=this._types[h];if(!i)return void console.error("Unknown resource type: "+g);var j=this._cache[g];if(j){if(j.isReady()){d.push(j);continue}}else j=this._cache[g]=new i(g,this),j.setLoader(this);j.extension=h,e++,j.once("ready",function(a){console.log("Loaded asset: "+a.url),e--,c()}),j.once("failed",function(a){console.log("Failed to load asset: "+a.url),e--,c()}),j.load(),d.push(j)}var k=d.length>1?d:d[0];return 0===e&&(this.world&&b?this._doneQueue.push({cb:b,result:k}):b&&_.defer(function(){b(k)})),k},c}();a.ResourceLoader=c}(pow2||(pow2={}));
//# sourceMappingURL=pow-core.min.map