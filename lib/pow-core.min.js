
/*!
  pow-core - v0.0.7
  built: 2014-08-09
 */

var pow2;!function(a){!function(a){a.INVALID_ARGUMENTS="invalid arguments",a.DIVIDE_ZERO="divide by zero operation",a.CLASS_NOT_IMPLEMENTED="must be implemented in a subclass",a.REQUIRED_ARGUMENT="argument must be valid",a.ALREADY_EXISTS="already exists and would overwrite existing value"}(a.errors||(a.errors={}));a.errors}(pow2||(pow2={}));var pow2;!function(a){function b(a){return e[a]}function c(b,c){if(!b)throw new Error(a.errors.REQUIRED_ARGUMENT);if(e.hasOwnProperty(b))throw new Error(a.errors.ALREADY_EXISTS);return e[b]=c,e[b]}function d(b){if(!b)throw new Error(a.errors.REQUIRED_ARGUMENT);if(!e.hasOwnProperty(b))throw new Error(a.errors.INVALID_ARGUMENTS);var c=e[b];return delete e[b],c}var e={};a.getWorld=b,a.registerWorld=c,a.unregisterWorld=d}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function a(){}return a.prototype.on=function(a,b,c){if(!d(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var e=this._events[a]||(this._events[a]=[]);return e.push({callback:b,context:c,ctx:c||this}),this},a.prototype.once=function(a,b,c){if(!d(this,"once",a,[b,c])||!b)return this;var e=this,f=_.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,c)},a.prototype.off=function(a,b,c){var e,f,g,h,i,j,k,l;if(!this._events||!d(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events=void 0,this;for(h=a?[a]:_.keys(this._events),i=0,j=h.length;j>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||c)for(k=0,l=g.length;l>k;k++)f=g[k],(b&&b!==f.callback&&b!==f.callback._callback||c&&c!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},a.prototype.trigger=function(a){for(var b=[],c=0;c<arguments.length-1;c++)b[c]=arguments[c+1];if(!this._events)return this;var b=Array.prototype.slice.call(arguments,1);if(!d(this,"trigger",a,b))return this;var f=this._events[a],g=this._events.all;return f&&e(f,b),g&&e(g,arguments),this},a}();a.Events=b;var c=/\s+/,d=function(a,b,d,e){if(!d)return!0;if("object"==typeof d){for(var f in d)a[b].apply(a,[f,d[f]].concat(e));return!1}if(c.test(d)){for(var g=d.split(c),h=0,i=g.length;i>h;h++)a[b].apply(a,[g[h]].concat(e));return!1}return!0},e=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}}}(pow2||(pow2={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},pow2;!function(a){var b=function(b){function c(a,c){"undefined"==typeof c&&(c=null),b.call(this),this.loader=null,this._ready=!1,this.url=a,this.data=c}return __extends(c,b),c.prototype.load=function(){throw new Error(a.errors.CLASS_NOT_IMPLEMENTED)},c.prototype.setLoader=function(a){this.loader=a},c.prototype.isReady=function(){return null!==this.data&&this._ready===!0},c.prototype.ready=function(){this._ready=!0,this.trigger(c.READY,this)},c.prototype.failed=function(){this._ready=!1,this.trigger(c.FAILED,this)},c.READY="ready",c.FAILED="failed",c}(a.Events);a.Resource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(a,c){a instanceof b?this.set(a.x,a.y):"string"==typeof a&&"string"==typeof c?this.set(parseFloat(a),parseFloat(c)):"number"==typeof a&&"number"==typeof c?this.set(a,c):this.zero()}return b.prototype.toString=function(){return""+this.x+","+this.y},b.prototype.set=function(c,d){if(c instanceof b)this.x=c.x,this.y=c.y;else{if("number"!=typeof c||"number"!=typeof d)throw new Error(a.errors.INVALID_ARGUMENTS);this.x=c,this.y=d}return this},b.prototype.clone=function(){return new b(this.x,this.y)},b.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},b.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},b.prototype.add=function(a,c){return a instanceof b?(this.x+=a.x,this.y+=a.y):"number"==typeof a&&"undefined"==typeof c?(this.x+=a,this.y+=a):(this.x+=a,this.y+=c),this},b.prototype.subtract=function(a,c){return a instanceof b?(this.x-=a.x,this.y-=a.y):"number"==typeof a&&"undefined"==typeof c?(this.x-=a,this.y-=a):(this.x-=a,this.y-=c),this},b.prototype.multiply=function(a,c){return a instanceof b?(this.x*=a.x,this.y*=a.y):"number"==typeof a&&"undefined"==typeof c?(this.x*=a,this.y*=a):(this.x*=a,this.y*=c),this},b.prototype.divide=function(c,d){if(c instanceof b){if(0===c.x||0===c.y)throw new Error(a.errors.DIVIDE_ZERO);this.x/=c.x,this.y/=c.y}else if("number"==typeof c&&"undefined"==typeof d){if(0===c)throw new Error(a.errors.DIVIDE_ZERO);this.x/=c,this.y/=c}else{if(0===c||0===d)throw new Error(a.errors.DIVIDE_ZERO);this.x/=c,this.y/=d}return this},b.prototype.inverse=function(){return this.x*=-1,this.y*=-1,this},b.prototype.equal=function(a){return this.x===a.x&&this.y===a.y},b.prototype.isZero=function(){return 0===this.x&&0===this.y},b.prototype.zero=function(){return this.x=this.y=0,this},b.prototype.interpolate=function(a,b,c){return c=Math.min(Math.max(c,0),1),this.x=a.x*(1-c)+b.x*c,this.y=a.y*(1-c)+b.y*c,this},b}();a.Point=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(c,d,e,f){return c instanceof b?(this.point=new a.Point(c.point),this.extent=new a.Point(c.extent)):"number"==typeof e&&"number"==typeof f?(this.point=new a.Point(c,d),this.extent=new a.Point(e,f)):c instanceof a.Point&&d instanceof a.Point?(this.point=new a.Point(c),this.extent=new a.Point(d)):(this.point=new a.Point(0,0),this.extent=new a.Point(1,1)),this}return b.prototype.toString=function(){return this.point.toString()+","+this.extent.toString()},b.prototype.set=function(c,d,e,f){if(c instanceof b)this.point.set(c.point),this.extent.set(c.extent);else if("number"==typeof e&&"number"==typeof f)this.point.set(c,d),this.extent.set(e,f);else{if(!(c instanceof a.Point&&d instanceof a.Point))throw new Error(a.errors.INVALID_ARGUMENTS);this.point.set(c),this.extent.set(d)}return this},b.prototype.clone=function(){return new b(this.point.clone(),this.extent.clone())},b.prototype.clip=function(a){var b=this.point.x+this.extent.x,c=this.point.y+this.extent.y;return this.point.x=Math.max(a.point.x,this.point.x),this.extent.x=Math.min(a.point.x+a.extent.x,b)-this.point.x,this.point.y=Math.max(a.point.y,this.point.y),this.extent.y=Math.min(a.point.y+a.extent.y,c)-this.point.y,this},b.prototype.isValid=function(){return this.extent.x>0&&this.extent.y>0},b.prototype.intersect=function(a){return!(a.point.x>this.point.x+this.extent.x||a.point.x+a.extent.x<this.point.x||a.point.y>this.point.y+this.extent.y||a.point.y+a.extent.y<this.point.y)},b.prototype.pointInRect=function(b,c){var d=0;if(b instanceof a.Point)d=b.x,c=b.y;else{if("number"!=typeof b||"number"!=typeof c)throw new Error(a.errors.INVALID_ARGUMENTS);d=b}return d>=this.point.x+this.extent.x||c>=this.point.y+this.extent.y?!1:!(d<this.point.x||c<this.point.y)},b.prototype.getCenter=function(){var b=parseFloat((this.point.x+.5*this.extent.x).toFixed(2)),c=parseFloat((this.point.y+.5*this.extent.y).toFixed(2));return new a.Point(b,c)},b.prototype.setCenter=function(b,c){var d;return b instanceof a.Point?(d=b.x,c=b.y):d=b,this.point.x=parseFloat((d-.5*this.extent.x).toFixed(2)),this.point.y=parseFloat((c-.5*this.extent.y).toFixed(2)),this},b.prototype.getLeft=function(){return this.point.x},b.prototype.getTop=function(){return this.point.y},b.prototype.getRight=function(){return this.point.x+this.extent.x},b.prototype.getBottom=function(){return this.point.y+this.extent.y},b.prototype.getHalfSize=function(){return new a.Point(this.extent.x/2,this.extent.y/2)},b.prototype.addPoint=function(a){a.x<this.point.x&&(this.extent.x=this.extent.x-(a.x-this.point.x),this.point.x=a.x),a.y<this.point.y&&(this.extent.y=this.extent.y-(a.x-this.point.y),this.point.y=a.y),a.x>this.point.x+this.extent.x&&(this.extent.x=a.x-this.point.x),a.y>this.point.y+this.extent.y&&(this.extent.y=a.y-this.point.y)},b.prototype.inflate=function(a,b){return"undefined"==typeof a&&(a=1),"undefined"==typeof b&&(b=1),this.point.x-=a,this.extent.x+=2*a,this.point.y-=b,this.extent.y+=2*b,this},b}();a.Rect=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,c=_.keys(b.types).length,d=[],e=function(b){c--,d.push(b),0>=c&&a.failed("No valid sources at the following URLs\n   "+d.join("\n   "))},f=document.createElement("audio");_.each(b.types,function(b,d){if(!f.canPlayType(b+";"))return void c--;var g=document.createElement("source");g.type=b,g.src=a.url+"."+d,g.addEventListener("error",function(a){return e(g.src),a.preventDefault(),a.stopImmediatePropagation(),!1}),f.appendChild(g)}),f.addEventListener("canplaythrough",function(){a.data=f,a.ready()}),f.load()},b.types={mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav"},b}(a.Resource);a.AudioResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=document.createElement("img");b.onload=function(){a.data=b,a.ready()},b.onerror=function(b){a.failed(b)},b.src=this.url},b}(a.Resource);a.ImageResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=$.getJSON(this.url);b.done(function(b){a.data=b,a.ready()}),b.fail(function(b,c,d){a.failed(d)})},b}(a.Resource);a.JSONResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=$.getScript(this.url);b.done(function(b){a.data=b,a.ready()}),b.fail(function(b,c,d){a.failed(d)})},b}(a.Resource);a.ScriptResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.load=function(){var a=this,b=$.get(this.url);b.done(function(b){a.data=$(b),a.prepare(a.data)}),b.fail(function(b,c,d){a.failed(d)})},b.prototype.prepare=function(){this.ready()},b.prototype.getRootNode=function(a){return this.data?$(_.find(this.data,function(b){return b.tagName&&b.tagName.toLowerCase()===a})):null},b.prototype.getChildren=function(a,b){var c=a.find(b);return _.compact(_.map(c,function(b){var c=$(b);return c.parent()[0]!==a[0]?null:c}))},b.prototype.getChild=function(a,b){return this.getChildren(a,b)[0]},b.prototype.getElAttribute=function(a,b){if(a){var c=a.attr(b);if(c)return c}return null},b}(a.Resource);a.XMLResource=b}(pow2||(pow2={}));var pow2;!function(a){var b=null,c=function(){function c(){this.tickRateMS=32,this.mspf=0,this.world=null,this.lastTime=0,this.time=0,this.running=!1,this.objects=[],this.polyFillAnimationFrames()}return c.get=function(){return b||(b=new a.Time),b},c.prototype.start=function(){var a=this;if(!this.running){this.running=!0;var b=function(c){a.time=Math.floor(c);var d=(new Date).getMilliseconds(),e=Math.floor(c-a.lastTime);e>=a.tickRateMS&&(a.lastTime=c,a.tickObjects(e)),a.processFrame(e),a.mspf=(new Date).getMilliseconds()-d,window.requestAnimationFrame(b)};b(0)}},c.prototype.stop=function(){this.running=!1},c.prototype.removeObject=function(a){this.objects=_.reject(this.objects,function(b){return b._uid===a._uid})},c.prototype.addObject=function(a){if(!a._uid)throw new Error("Invalid object contains no _uid ->"+a);_.where(this.objects,{_uid:a._uid}).length>0||this.objects.push(a)},c.prototype.tickObjects=function(a){for(var b=this.objects,c=b.length-1;c>=0;--c)b[c].tick&&b[c].tick(a)},c.prototype.processFrame=function(a){for(var b=this.objects,c=b.length-1;c>=0;--c)b[c].processFrame&&b[c].processFrame(a)},c.prototype.polyFillAnimationFrames=function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length;c++){if(window.requestAnimationFrame)return;window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=function(){b(c+d)},f=window.setTimeout(e,d);return a=c+d,f})},c}();a.Time=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(b){var c=this;this.loader=null,b=_.defaults(b||{},{loader:new a.ResourceLoader,time:new a.Time}),_.extend(this,b),_.each(b,function(a){c.mark(a)})}return b.prototype.setService=function(a,b){return this.mark(b),this[a]=b,b},b.prototype.mark=function(a){a&&(a.world=this,a.onAddToWorld&&a.onAddToWorld(this))},b.prototype.erase=function(a){a&&(a.onRemoveFromWorld&&a.onRemoveFromWorld(this),delete a.world)},b}();a.World=b}(pow2||(pow2={}));var pow2;!function(a){var b=null,c=function(){function c(){this._cache={},this._types={png:a.ImageResource,js:a.ScriptResource,json:a.JSONResource,xml:a.XMLResource,tmx:a.TiledTMXResource,tsx:a.TiledTSXResource,"":a.AudioResource},this._doneQueue=[],this.world=null,this._uid=_.uniqueId("res")}return c.get=function(){return b||(b=new a.ResourceLoader),b},c.prototype.onAddToWorld=function(a){a.time.addObject(this)},c.prototype.onRemoveFromWorld=function(a){a.time.removeObject(this)},c.prototype.tick=function(){},c.prototype.processFrame=function(){var a=this._doneQueue;this._doneQueue=[],_.each(a,function(a){a.cb(a.result)})},c.prototype.registerType=function(a,b){this._types[a]=b},c.prototype.getResourceExtension=function(a){var b=a.lastIndexOf(".");return-1===b?"":a.substr(b+1)},c.prototype.create=function(a,b){var c=new a(null,b);return c.setLoader(this),c},c.prototype.loadAsType=function(a,b,c){var d=this,e=function(a){d.world&&c?d._doneQueue.push({cb:c,result:a}):c&&_.defer(function(){c(a)})};if(!b)return e(null),void console.error("Unknown resource type: "+a);var f=this._cache[a];if(f){if(f.isReady())return e(f)}else f=this._cache[a]=new b(a,this),f.setLoader(this);return f.once("ready",function(a){console.log("Loaded asset: "+a.url),e(a)}),f.once("failed",function(a){e(a)}),f.load(),f},c.prototype.load=function(a,b){function c(){if(b&&0===e){var a=d.length>1?d:d[0];b(a)}}var d=[],e=0;_.isArray(a)||(a=[a]);for(var f=0;f<a.length;f++){var g=a[f],h=this.getResourceExtension(g),i=this._types[h];if(!i)return void console.error("Unknown resource type: "+g);var j=this._cache[g];if(j){if(j.isReady()){d.push(j);continue}}else j=this._cache[g]=new i(g,this),j.setLoader(this);j.extension=h,e++,j.once("ready",function(a){console.log("Loaded asset: "+a.url),e--,c()}),j.once("failed",function(a){console.log("Failed to load asset: "+a.url),e--,c()}),j.load(),d.push(j)}var k=d.length>1?d:d[0];return 0===e&&(this.world&&b?this._doneQueue.push({cb:b,result:k}):b&&_.defer(function(){b(k)})),k},c}();a.ResourceLoader=c}(pow2||(pow2={}));var pow2;!function(a){!function(a){function b(a){return{name:g(a,"name"),x:parseInt(g(a,"x")||"0"),y:parseInt(g(a,"y")||"0"),width:parseInt(g(a,"width")||"0"),height:parseInt(g(a,"height")||"0"),visible:1===parseInt(g(a,"visible")||"1"),_xml:a}}function c(a){var c=b(a);c.opacity=parseInt(g(a,"opacity")||"1");var e=d(a);return e&&(c.properties=e),c._xml=a,c}function d(a){var b=f(a,"properties");if(b&&b.length>0){var c={},d=e(b,"property");return _.each(d,function(a){var b=g(a,"name"),d=g(a,"value");if("string"==typeof d){var e=d.toLowerCase();"true"===e||"false"===e?d="true"===e:isNaN(e=parseFloat(d))||(d=e)}c[b]=d}),c}return null}function e(a,b){var c=a.find(b);return _.compact(_.map(c,function(b){var c=$(b);return c.parent()[0]!==a[0]?null:c}))}function f(a,b){return e(a,b)[0]}function g(a,b){if(a){var c=a.attr(b);if(c)return c}return null}a.readITiledBase=b,a.readITiledLayerBase=c,a.readTiledProperties=d,a.getChildren=e,a.getChild=f,a.getElAttribute=g}(a.tiled||(a.tiled={}));a.tiled}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function a(a){this.properties={},this.id=a}return a}();a.TilesetTile=b;var c=function(c){function d(){c.apply(this,arguments),this.name=null,this.tilewidth=16,this.tileheight=16,this.imageWidth=0,this.imageHeight=0,this.image=null,this.firstgid=-1,this.tiles=[]}return __extends(d,c),d.prototype.prepare=function(){var c=this,d=this.getRootNode("tileset");this.name=this.getElAttribute(d,"name"),this.tilewidth=parseInt(this.getElAttribute(d,"tilewidth")),this.tileheight=parseInt(this.getElAttribute(d,"tileheight"));var e=this.getChildren(d,"tile");_.each(e,function(d){var e=parseInt(c.getElAttribute(d,"id")),f=new b(e);f.properties=a.tiled.readTiledProperties(d),c.tiles.push(f)});var f=this.getChild(d,"img");if(f&&f.length>0){var g=this.getElAttribute(f,"source");this.imageWidth=parseInt(this.getElAttribute(f,"width")||"0"),this.imageHeight=parseInt(this.getElAttribute(f,"height")||"0"),console.log("Tileset source: "+g),this.url=this.url.substr(0,this.url.lastIndexOf("/")+1)+g,this.loader.load(this.url,function(a){if(c.image=a,!a.isReady())return void c.failed("Failed to load required TileMap image: "+g);c.imageWidth=c.image.data.width,c.imageHeight=c.image.data.height;for(var b=c.imageWidth/c.tilewidth,d=c.imageHeight/c.tileheight,e=b*d,f=new Array(e),h=0;e>h;h++)f[h]=!1;_.each(c.tiles,function(a){f[a.id]=a.properties}),c.tiles=f,c.ready()})}else this.ready()},d.prototype.hasGid=function(a){return-1!==this.firstgid&&a>=this.firstgid&&a<this.firstgid+this.tiles.length},d.prototype.getTileMeta=function(a){var b=-1!==this.firstgid?a-this.firstgid:a,c=this.imageWidth/this.tilewidth,d=b%c,e=Math.floor((b-d)/c);return _.extend(this.tiles[b]||{},{image:this.image,url:this.url,x:d*this.tilewidth,y:e*this.tileheight,width:this.tilewidth,height:this.tileheight})},d}(a.XMLResource);a.TiledTSXResource=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.width=0,this.height=0,this.orientation="orthogonal",this.tileheight=16,this.tilewidth=16,this.version=1,this.properties={},this.tilesets={},this.layers=[],this.objectGroups=[]}return __extends(c,b),c.prototype.prepare=function(b){var c=this;this.$map=this.getRootNode("map"),this.version=parseInt(this.getElAttribute(this.$map,"version")),this.width=parseInt(this.getElAttribute(this.$map,"width")),this.height=parseInt(this.getElAttribute(this.$map,"height")),this.orientation=this.getElAttribute(this.$map,"orientation"),this.tileheight=parseInt(this.getElAttribute(this.$map,"tileheight")),this.tilewidth=parseInt(this.getElAttribute(this.$map,"tilewidth")),this.properties=a.tiled.readTiledProperties(this.$map);var d=[],e=this.getChildren(this.$map,"tileset");_.each(e,function(a){var b=c.getElAttribute(a,"source"),e=parseInt(c.getElAttribute(a,"firstgid")||"-1");d.push(b?{source:b,firstgid:e}:{data:a,source:c.url,firstgid:e})});var f=this.getChildren(this.$map,"layer");_.each(f,function(b){var d=a.tiled.readITiledLayerBase(b);c.layers.push(d);var e=c.getChild(b,"data");if(e){var f=c.getElAttribute(e,"encoding");f&&"csv"===f.toLowerCase()||c.failed("Pow2 only supports CSV maps.  Edit the Map Properties (for:"+c.url+") in Tiled to use the CSV option when saving."),d.data=JSON.parse("["+$.trim(e.text())+"]")}});var g=this.getChildren(this.$map,"objectgroup");_.each(g,function(b){var d=a.tiled.readITiledLayerBase(b);d.objects=[];var e=c.getElAttribute(b,"color");e&&(d.color=e);var f=c.getChildren(b,"object");_.each(f,function(b){d.objects.push(a.tiled.readITiledLayerBase(b))}),c.objectGroups.push(d)});var h=function(){if(d.length<=0)return c.ready();var e=d.shift();if(e.data){var f=c.loader.create(a.TiledTSXResource,e.data);f.url=e.source,f.once(a.Resource.READY,function(){c.tilesets[f.name]=f,f.firstgid=e.firstgid,h()}),f.once(a.Resource.FAILED,function(a){c.failed(a)}),f.prepare(b)}else{if(!e.source)throw new Error("Unknown type of tile set data");c.loader.load(e.source,function(a){c.tilesets[a.name]=a,a.firstgid=e.firstgid,h()})}};h()},c}(a.XMLResource);a.TiledTMXResource=b}(pow2||(pow2={}));
//# sourceMappingURL=pow-core.min.map